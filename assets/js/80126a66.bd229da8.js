"use strict";(self.webpackChunkwebsitev_3=self.webpackChunkwebsitev_3||[]).push([[6500],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return m}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=u(n),m=a,b=d["".concat(s,".").concat(m)]||d[m]||c[m]||o;return n?r.createElement(b,i(i({ref:t},p),{},{components:n})):r.createElement(b,i({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var u=2;u<o;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},8215:function(e,t,n){n.d(t,{Z:function(){return a}});var r=n(7294);function a(e){var t=e.children,n=e.hidden,a=e.className;return r.createElement("div",{role:"tabpanel",hidden:n,className:a},t)}},9877:function(e,t,n){n.d(t,{Z:function(){return p}});var r=n(7462),a=n(7294),o=n(2389),i=n(5979),l=n(6010),s="tabItem_LplD";function u(e){var t,n,o,u=e.lazy,p=e.block,c=e.defaultValue,d=e.values,m=e.groupId,b=e.className,f=a.Children.map(e.children,(function(e){if((0,a.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),v=null!=d?d:f.map((function(e){var t=e.props;return{value:t.value,label:t.label,attributes:t.attributes}})),k=(0,i.lx)(v,(function(e,t){return e.value===t.value}));if(k.length>0)throw new Error('Docusaurus error: Duplicate values "'+k.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var h=null===c?c:null!=(t=null!=c?c:null==(n=f.find((function(e){return e.props.default})))?void 0:n.props.value)?t:null==(o=f[0])?void 0:o.props.value;if(null!==h&&!v.some((function(e){return e.value===h})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+h+'" but none of its children has the corresponding value. Available values are: '+v.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var g=(0,i.UB)(),j=g.tabGroupChoices,y=g.setTabGroupChoices,N=(0,a.useState)(h),x=N[0],w=N[1],C=[],T=(0,i.o5)().blockElementScrollPositionUntilNextRender;if(null!=m){var E=j[m];null!=E&&E!==x&&v.some((function(e){return e.value===E}))&&w(E)}var O=function(e){var t=e.currentTarget,n=C.indexOf(t),r=v[n].value;r!==x&&(T(t),w(r),null!=m&&y(m,r))},D=function(e){var t,n=null;switch(e.key){case"ArrowRight":var r=C.indexOf(e.currentTarget)+1;n=C[r]||C[0];break;case"ArrowLeft":var a=C.indexOf(e.currentTarget)-1;n=C[a]||C[C.length-1]}null==(t=n)||t.focus()};return a.createElement("div",{className:"tabs-container"},a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":p},b)},v.map((function(e){var t=e.value,n=e.label,o=e.attributes;return a.createElement("li",(0,r.Z)({role:"tab",tabIndex:x===t?0:-1,"aria-selected":x===t,key:t,ref:function(e){return C.push(e)},onKeyDown:D,onFocus:O,onClick:O},o,{className:(0,l.Z)("tabs__item",s,null==o?void 0:o.className,{"tabs__item--active":x===t})}),null!=n?n:t)}))),u?(0,a.cloneElement)(f.filter((function(e){return e.props.value===x}))[0],{className:"margin-vert--md"}):a.createElement("div",{className:"margin-vert--md"},f.map((function(e,t){return(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==x})}))))}function p(e){var t=(0,o.Z)();return a.createElement(u,(0,r.Z)({key:String(t)},e))}},8405:function(e,t,n){n.r(t),n.d(t,{assets:function(){return d},contentTitle:function(){return p},default:function(){return f},frontMatter:function(){return u},metadata:function(){return c},toc:function(){return m}});var r=n(7462),a=n(3366),o=(n(7294),n(3905)),i=n(9877),l=n(8215),s=["components"],u={id:"jobs",title:"Jobs",sidebar_label:"Jobs",sidebar_position:5},p=void 0,c={unversionedId:"basics/jobs",id:"basics/jobs",title:"Jobs",description:"Jobs are pre-programmed background processes that can be scheduled to run after a certain period of time.",source:"@site/docs/basics/jobs.md",sourceDirName:"basics",slug:"/basics/jobs",permalink:"/docs/basics/jobs",editUrl:"https://github.com/facebook/docusaurus/edit/main/website/docs/basics/jobs.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{id:"jobs",title:"Jobs",sidebar_label:"Jobs",sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Collections",permalink:"/docs/basics/collections"},next:{title:"GraphQL",permalink:"/docs/modules/graphql"}},d={},m=[{value:"Proposed structure",id:"proposed-structure",level:2},{value:"Start jobs",id:"start-jobs",level:2},{value:"Example",id:"example",level:3},{value:"Define a Job",id:"define-a-job",level:2},{value:"Types of jobs",id:"types-of-jobs",level:2},{value:"Event jobs",id:"event-jobs",level:3},{value:"Define event job",id:"define-event-job",level:4},{value:"Call event job",id:"call-event-job",level:4},{value:"Example calling the previously defined myEventJob",id:"example-calling-the-previously-defined-myeventjob",level:5},{value:"Example using uniqueIdentifier &amp; params",id:"example-using-uniqueidentifier--params",level:5},{value:"Recurrent jobs",id:"recurrent-jobs",level:3}],b={toc:m};function f(e){var t=e.components,n=(0,a.Z)(e,s);return(0,o.kt)("wrapper",(0,r.Z)({},b,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"Jobs")," are pre-programmed background processes that can be scheduled to run after a certain period of time."),(0,o.kt)("h1",{id:"install-package"},"Install package"),(0,o.kt)(i.Z,{groupId:"npm2yarn",mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"npm",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"npm install @orion-js/dogs @orion-js/logger\n"))),(0,o.kt)(l.Z,{value:"yarn",label:"Yarn",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"yarn add @orion-js/dogs @orion-js/logger\n")))),(0,o.kt)("h2",{id:"proposed-structure"},"Proposed structure"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"app\n\u2514\u2500\u2500 jobs\n    \u251c\u2500\u2500 job1\n    \u2502   \u2514\u2500\u2500 index.ts\n    \u251c\u2500\u2500 job2\n    \u2502   \u2514\u2500\u2500 index.ts\n    \u2514\u2500\u2500 index.ts\n")),(0,o.kt)("h2",{id:"start-jobs"},"Start jobs"),(0,o.kt)("p",null,"To start the jobs, we must use the ",(0,o.kt)("inlineCode",{parentName:"p"},"startWorkers")," function:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"jobs"),": Object map of the jobs that this workers will execute."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"workersCount?"),": Number of workers to start. ",(0,o.kt)("strong",{parentName:"li"},"Default is 4"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"lockTime?"),": Time in milliseconds to lock a job for execution. ",(0,o.kt)("strong",{parentName:"li"},"Default is 30000 (30 seconds)"),". If a job is locked for longer than this time, it will be considered as failed. This is to prevent a job from being executed multiple times at the same time. You can extend this time inside a job by calling extendLockTime from context."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"pollInterval?"),": Time in milliseconds to wait between each look without results for a job to run at the database. ",(0,o.kt)("strong",{parentName:"li"},"Default is 3000"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"cooldownPeriod?"),": Time in milliseconds to wait too look for a job after a job execution. ",(0,o.kt)("strong",{parentName:"li"},"Default is 100"),".")),(0,o.kt)("h3",{id:"example"},"Example"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="app/jobs/index.ts"',title:'"app/jobs/index.ts"'},"import {startWorkers} from '@orion-js/dogs'\nimport jobs from 'app/components/jobs'\n\nstartWorkers({\n  jobs,\n  workersCount: 5\n})\n")),(0,o.kt)("h2",{id:"define-a-job"},"Define a Job"),(0,o.kt)("p",null,"To define a job, use ",(0,o.kt)("inlineCode",{parentName:"p"},"defineJob")," function from the package ",(0,o.kt)("inlineCode",{parentName:"p"},"@orion-js/dogs"),"."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"type"),": Type of the job: ",(0,o.kt)("inlineCode",{parentName:"li"},"event"),"|",(0,o.kt)("inlineCode",{parentName:"li"},"recurrent")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"resolve"),": Async function to execute when the job is executed."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"priority?"),": The priority of the job. Higher is more priority. ",(0,o.kt)("strong",{parentName:"li"},"Default is 1"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"runEvery?"),": Run every x milliseconds. ",(0,o.kt)("em",{parentName:"li"},"This will be ignored if getNextRun is defined.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"getNextRun?"),": A function executed after each execution that returns the date of the next run.."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"onError?"),": Called if the job fails."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"onStale?"),": Called if the job locktime is expired. The job will be executed again.."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"saveExecutionsFor?"),": Save the executions of the job time in milliseconds. ",(0,o.kt)("strong",{parentName:"li"},"Default is 1 week"),". Set to 0 to disable.")),(0,o.kt)("h2",{id:"types-of-jobs"},"Types of jobs"),(0,o.kt)("p",null,"All jobs have cluster support (run only once on any server) and the execution of the jobs may not be in the same server from which it was called."),(0,o.kt)("p",null,"There are two types of jobs: ",(0,o.kt)("inlineCode",{parentName:"p"},"event")," & ",(0,o.kt)("inlineCode",{parentName:"p"},"recurrent"),"."),(0,o.kt)("h3",{id:"event-jobs"},"Event jobs"),(0,o.kt)("p",null,"To use event job, we first define it and then call it."),(0,o.kt)("h4",{id:"define-event-job"},"Define event job"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="myEventJob.ts"',title:'"myEventJob.ts"'},"import {defineJob} from '@orion-js/dogs'\n\nexport default defineJob({\n  type: 'event',\n  async resolve(params) {\n    // execute something\n  }\n})\n")),(0,o.kt)("h4",{id:"call-event-job"},"Call event job"),(0,o.kt)("p",null,"To call a job, the ",(0,o.kt)("inlineCode",{parentName:"p"},"scheduleJob")," function must be imported, this function uses the following parameters:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"name"),": String name job."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"uniqueIdentifier?"),": Unique identifier."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"params?"),": Additional parameters passed to the job function.")),(0,o.kt)("h5",{id:"example-calling-the-previously-defined-myeventjob"},"Example calling the previously defined myEventJob"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"import {scheduleJob} from '@orion-js/dogs'\n\nscheduleJob({\n  name: 'myEventJob'\n})\n  .then()\n  .catch()\n")),(0,o.kt)("h5",{id:"example-using-uniqueidentifier--params"},"Example using uniqueIdentifier & params"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"import {scheduleJob} from '@orion-js/dogs'\n\nscheduleJob({\n  name: 'makeZoneRequest',\n  uniqueIdentifier: 'makeZoneRequest-CL',\n  params: {zoneId: zone._id}\n})\n  .then()\n  .catch()\n")),(0,o.kt)("h3",{id:"recurrent-jobs"},"Recurrent jobs"),(0,o.kt)("p",null,"The recurring jobs will be executed again at the defined time and once the current one has finished, if it is running (if the time has passed, it will run again)."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"import {defineJob} from '@orion-js/dogs'\n\nexport default job({\n  type: 'recurrent',\n  runEvery: 1000, // runs every 1000 ms\n  async resolve(params) {\n    // execute something\n  }\n})\n")),(0,o.kt)("p",null,"This jobs will be called automatically. You can only specify ",(0,o.kt)("inlineCode",{parentName:"p"},"runEvery")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"getNextRun")," in a job."))}f.isMDXComponent=!0}}]);