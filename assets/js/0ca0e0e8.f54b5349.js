"use strict";(self.webpackChunkwebsitev_3=self.webpackChunkwebsitev_3||[]).push([[7599],{3905:function(e,t,n){n.d(t,{Zo:function(){return m},kt:function(){return u}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),d=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},m=function(e){var t=d(e.components);return a.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,m=i(e,["components","mdxType","originalType","parentName"]),c=d(n),u=r,h=c["".concat(s,".").concat(u)]||c[u]||p[u]||l;return n?a.createElement(h,o(o({ref:t},m),{},{components:n})):a.createElement(h,o({ref:t},m))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,o=new Array(l);o[0]=c;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:r,o[1]=i;for(var d=2;d<l;d++)o[d]=n[d];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},8568:function(e,t,n){n.r(t),n.d(t,{assets:function(){return m},contentTitle:function(){return s},default:function(){return u},frontMatter:function(){return i},metadata:function(){return d},toc:function(){return p}});var a=n(7462),r=n(3366),l=(n(7294),n(3905)),o=["components"],i={id:"models",title:"Models",sidebar_label:"Models",sidebar_position:2},s=void 0,d={unversionedId:"basics/models",id:"version-2.x/basics/models",title:"Models",description:"Create a model",source:"@site/versioned_docs/version-2.x/basics/models.md",sourceDirName:"basics",slug:"/basics/models",permalink:"/docs/2.x/basics/models",editUrl:"https://github.com/facebook/docusaurus/edit/main/website/docs/basics/models.md",tags:[],version:"2.x",sidebarPosition:2,frontMatter:{id:"models",title:"Models",sidebar_label:"Models",sidebar_position:2},sidebar:"version-2.x/tutorialSidebar",previous:{title:"Schema",permalink:"/docs/2.x/basics/schema"},next:{title:"Resolvers",permalink:"/docs/2.x/basics/resolvers"}},m={},p=[{value:"Create a model",id:"create-a-model",level:2},{value:"Schema",id:"schema",level:3},{value:"Resolvers",id:"resolvers",level:3},{value:"Obtain the owner name example.",id:"obtain-the-owner-name-example",level:4},{value:"To GraphQL",id:"to-graphql",level:3},{value:"Clone a model",id:"clone-a-model",level:2},{value:"Clone model example",id:"clone-model-example",level:4},{value:"Init item",id:"init-item",level:2},{value:"Validate and clean",id:"validate-and-clean",level:2},{value:"Examples",id:"examples",level:4}],c={toc:p};function u(e){var t=e.components,n=(0,r.Z)(e,o);return(0,l.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h2",{id:"create-a-model"},"Create a model"),(0,l.kt)("p",null,"The models in Orionjs define the structure of a collection which are its variables and types. It validates that the data entering or leaving the collection is coherent with the defined structure in the schema, and allows queries and operations to the database in Mongo through the use of resolvers."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"server\n\u2514\u2500\u2500 app\n    \u2514\u2500\u2500 models\n        \u2514\u2500\u2500 Model1\n            \u251c\u2500\u2500 schema\n            \u251c\u2500\u2500 resolvers\n            \u2502   \u251c\u2500\u2500 resolver1\n            \u2502   \u2514\u2500\u2500 index.js\n            \u2514\u2500\u2500 index.js\n")),(0,l.kt)("p",null,"By convention the models are created in the app/models folder, but you can create a model anywhere. Here is an example of the ",(0,l.kt)("inlineCode",{parentName:"p"},"index.js")," file of a Model."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"import {Model} from '@orion-js/app'\n\nexport default new Model({\n  name: 'Model1',\n  schema: () => require('./schema'),\n  resolvers: () => require('./resolvers')\n})\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"name"),": The name of the model."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"schema"),": Describes the structure of each model. The complete documentation of the schemas is in ",(0,l.kt)("a",{parentName:"li",href:"https://orionjs.com/docs/schema"},"Orionjs Schemas"),"."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"resolvers"),": The resolvers of the models are controllers or specific functions to obtain data that are not directly in the database. You can use the current information in the database of a collection to create an custom output data. See more in ",(0,l.kt)("a",{parentName:"li",href:"https://orionjs.com/docs/resolvers"},"Orionjs Resolvers"),".")),(0,l.kt)("h3",{id:"schema"},"Schema"),(0,l.kt)("p",null,"The schema you pass to the model represents the static data, like the data saved in the database."),(0,l.kt)("p",null,"If you pass a model to a collection, when you insert or update an item it will be validated against the model schema."),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Example:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"export default {\n  _id: {\n    type: 'ID'\n  },\n  userId: {\n    type: 'ID'\n  },\n  last4: {\n    type: String,\n    label: 'Last 4 digits'\n  },\n  isDefault: {\n    type: Boolean,\n    optional: true\n  }\n}\n")),(0,l.kt)("h3",{id:"resolvers"},"Resolvers"),(0,l.kt)("p",null,"Model resolvers represents dynamic variables. You can create them to obtain custom data that aren't directly present in the database or represented in the model schema.\nTaking the previous example of the credit card, the next example would be a resolver to obtain user specific data. This new resolver should be saved in the ",(0,l.kt)("inlineCode",{parentName:"p"},"Card/resolvers")," folder of the model and declared in the containing ",(0,l.kt)("inlineCode",{parentName:"p"},"index.js")," file."),(0,l.kt)("h4",{id:"obtain-the-owner-name-example"},"Obtain the owner name example."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"import {resolver} from '@orion-js/app'\nimport Users from 'app/collections/Users'\n\nexport default resolver({\n  returns: String,\n  async resolve(card, params, viewer) {\n    const user = await Users.findOne({_id: card.userId})\n    return user.name\n  }\n})\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"card")," : Variable that contains the data of an especific credit card ",(0,l.kt)("inlineCode",{parentName:"li"},"(_id, userId, last4, isDefault)"),"."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"params")," : This resolver can be called as a function and receive parameters."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"viewer")," : Contains meta data from the user's session. For example, ",(0,l.kt)("inlineCode",{parentName:"li"},"userId"),".")),(0,l.kt)("p",null,"Resulting ",(0,l.kt)("inlineCode",{parentName:"p"},"Card/resolvers/index.js")," file:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"import resolver1 from './resolver1'\nimport cardUser from './cardUser'\n\nexport default {\n  resolver1,\n  cardUser\n}\n")),(0,l.kt)("p",null,"When trying to get information from a Model resolver, refer to the resolver as if it were a Model function property:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const card = await Cards.findOne(cardId)\nreturn await card.cardUser()\n")),(0,l.kt)("h3",{id:"to-graphql"},"To GraphQL"),(0,l.kt)("p",null,"Orionjs will automatically convert this Model to a GraphQL model if it's referenced by any global resolver.\nSchema fields will be converted to simple resolvers (just gets the value) and resolvers will be converted to GraphQL resolvers."),(0,l.kt)("p",null,"If you need to convert a schema field to resolver only for GraphQL you can pass the resolver in the ",(0,l.kt)("inlineCode",{parentName:"p"},"graphQLResolver")," key."),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Example:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"import {resolver} from '@orion-js/app'\n\nexport default {\n  _id: {\n    type: 'ID'\n  },\n  secretData: {\n    type: String,\n    // this will only be executed in GraphQL and not when accesing the value serverside\n    graphQLResolver: resolver({\n      returns: String,\n      async resolve(item, params, viewer) {\n        if (!viewer.roles.includes('admin')) return null\n        return item.secretData\n      }\n    })\n  }\n}\n")),(0,l.kt)("h2",{id:"clone-a-model"},"Clone a model"),(0,l.kt)("p",null,"Sometimes you need a copy of your model with some changes. For example when creating a update resolver, you want to create a new model that has all the model fields except ",(0,l.kt)("inlineCode",{parentName:"p"},"_id")," or ",(0,l.kt)("inlineCode",{parentName:"p"},"createdAt"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"Model.clone({\n  name,\n  omitFields,\n  pickFields,\n  mapFields,\n  extendSchema,\n  extendResolvers\n})\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"name"),": The new name of the model."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"omitFields"),": Optional. An array of the schema fields you want to omit in the new model."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"pickFields"),": Optional. An array of the schema fields you want to pass to the new model. You may use ",(0,l.kt)("inlineCode",{parentName:"li"},"omitFields")," or ",(0,l.kt)("inlineCode",{parentName:"li"},"pickFields"),", but not both at the same time."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"mapFields"),": Optional. A function that receives a field of the schema and returns a replacement for that field."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"extendSchema"),": Optional. Add fields to the cloned model."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"extendResolvers"),": Optional. Add resolvers to the cloned model.")),(0,l.kt)("h4",{id:"clone-model-example"},"Clone model example"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"Model.clone({\n  name: 'ModelClone',\n  omitFields: ['_id, last4'],\n  mapFields(field, key) {\n    field.optional = true\n    return field\n  }\n})\n")),(0,l.kt)("h2",{id:"init-item"},"Init item"),(0,l.kt)("p",null,"Orionjs initializes items automatically when they come from the database, but if your data is not from a collection and you want to access resolvers, you need to initialize the item with the function ",(0,l.kt)("inlineCode",{parentName:"p"},"Model.initItem(data)")),(0,l.kt)("h2",{id:"validate-and-clean"},"Validate and clean"),(0,l.kt)("p",null,"The model exposes method to validate items directly against it's schema. ",(0,l.kt)("inlineCode",{parentName:"p"},"Model.validate(data)")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"Model.clean(data)"),"."),(0,l.kt)("h4",{id:"examples"},"Examples"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"Model.validate(data)")," can be use to check the legitimacy of an object according to the schema"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"import Model1 from 'app/models/Model1'\n\ntry {\n  await Model1.validate(data)\n} catch (error) {\n  return 'missing Option'\n}\n")),(0,l.kt)("p",null,"On the other side, ",(0,l.kt)("inlineCode",{parentName:"p"},"Model1.clean(data)")," removes all information from ",(0,l.kt)("inlineCode",{parentName:"p"},"data")," inconsistent with the schema."))}u.isMDXComponent=!0}}]);